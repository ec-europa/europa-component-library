/**
 * Table component
 * @define table
 */

@use 'sass:map';
@use '@ecl/vanilla-layout-grid/mixins/breakpoints';

// Exposed variables
$theme: null !default;
$table: null !default;

.ecl-table,
%ecl-table {
  border-collapse: collapse;
  color: map.get($table, 'table-color');
  font: var(--f-m);
  margin: 0;
  width: 100%;
}

.ecl-table-responsive {
  overflow-x: auto;
}

.ecl-table__head,
%ecl-table__head {
  border-bottom: map.get($table, 'head-border');
  background-color: map.get($table, 'head-background');
  display: table-header-group;
}

.ecl-table__header,
%ecl-table__header {
  font-weight: map.get($theme, 'font-weight', 'bold');
  padding: map.get($table, 'header-padding');
  text-align: start;
  vertical-align: bottom;
}

.ecl-table__row,
%ecl-table__row {
  border-bottom: map.get($table, 'row-border');
  border-top-width: 0;
}

.ecl-table__head .ecl-table__row:first-child {
  border-bottom: map.get($table, 'header-border');

  .ecl-table__header {
    padding-top: var(--s-m);
  }
}

.ecl-table__cell,
%ecl-table__cell {
  border-width: 0;
  display: table-cell;
  padding: map.get($table, 'cell-padding');
}

// Zebra
.ecl-table--zebra {
  .ecl-table__row:nth-of-type(even) {
    background-color: map.get($table, 'zebra-background');
  }
}

// Multi
.ecl-table__head .ecl-table__row:not(:first-child) {
  background-color: map.get($table, 'multi-head-background-empty');
  border-bottom-width: 0;
}

.ecl-table__head
  .ecl-table__row:not(:first-child)
  .ecl-table__header:not(:empty) {
  background-color: map.get($table, 'multi-head-background');
}

// Sort Table
.ecl-table__header[data-ecl-table-sort-toggle] {
  cursor: pointer;
  padding-inline-start: calc(
    #{map.get($theme, 'spacing', 'm')} + #{map.get($theme, 'icon', '2xs')} + #{map.get(
        $theme,
        'spacing',
        'xs'
      )}
  );
  position: relative;
}

.ecl-table__arrow {
  background-color: transparent;
  border: 0;
  cursor: pointer;
  height: map.get($table, 'button_arrow_height');
  left: map.get($theme, 'spacing', '2xs');
  margin-top: map.get($table, 'sort-arrow-margin-top');
  position: absolute;
  width: map.get($table, 'button_arrow_width');

  &:focus-visible {
    outline: 2px solid map.get($theme, 'color', 'blue');
    outline-offset: -4px;
  }
}

.ecl-table__icon {
  left: 0;
  position: absolute;
}

.ecl-table__icon-up {
  fill: map.get($table, 'sort-icon-color');
  top: 0;
}

.ecl-table__icon-down {
  fill: map.get($table, 'sort-icon-color');
  top: map.get($theme, 'icon', '2xs');
  transform: rotate(180deg);
}

.ecl-table__header[aria-sort='ascending'] {
  .ecl-table__icon-down {
    fill: map.get($table, 'sort-icon-color-active');
  }
}

.ecl-table__header[aria-sort='descending'] {
  .ecl-table__icon-up {
    fill: map.get($table, 'sort-icon-color-active');
  }
}

// Enhanced table (mobile)
/* stylelint-disable-next-line order/order */
@include breakpoints.down('m') {
  .ecl-table:not(.ecl-table--simple) {
    .ecl-table__head {
      display: none;
    }

    .ecl-table__cell {
      border-top: 1px solid map.get($table, 'row-border-color');
      display: flex;
      padding: map.get($theme, 'spacing', 's');

      &::before {
        background-color: map.get($theme, 'color', 'blue-5');
        border-inline-end: 2px solid map.get($table, 'header-border-color');
        content: attr(data-ecl-table-header);
        display: block;
        flex-basis: 10rem;
        flex-grow: 0;
        flex-shrink: 0;
        font-weight: map.get($theme, 'font-weight', 'bold');
        margin-bottom: -#{map.get($theme, 'spacing', 's')};
        margin-inline-start: -#{map.get($theme, 'spacing', 's')};
        margin-inline-end: map.get($theme, 'spacing', 's');
        margin-top: -#{map.get($theme, 'spacing', 's')};
        padding-bottom: map.get($theme, 'spacing', 's');
        padding-inline-start: map.get($theme, 'spacing', 's');
        padding-inline-end: map.get($theme, 'spacing', 'm');
        padding-top: map.get($theme, 'spacing', 's');
      }

      &:last-of-type {
        border-bottom: 1px solid map.get($table, 'row-border-color');
        margin-bottom: map.get($theme, 'spacing', 'l');
      }
    }

    .ecl-table__cell--group {
      &::before {
        background-color: map.get($theme, 'color', 'white-100');
        border-inline-end-color: map.get($theme, 'color', 'white-100');
        margin-inline-start: -#{map.get($theme, 'spacing', 's')};
        margin-inline-end: 0;
        padding-inline-start: map.get($theme, 'spacing', 'l');
      }
    }

    .ecl-table__cell[data-ecl-table-header-group] {
      display: grid;
      grid-template-columns:
        calc(
          10rem + #{map.get($theme, 'spacing', 'm')} + #{map.get(
              $theme,
              'spacing',
              's'
            )} + 2px
        )
        1fr;
      grid-template-rows: auto 1fr;
      position: relative;

      &::after {
        background-color: map.get($theme, 'color', 'blue-5');
        border-bottom: 1px solid map.get($table, 'row-border-color');
        content: attr(data-ecl-table-header-group);
        display: block;
        font-weight: map.get($theme, 'font-weight', 'bold');
        grid-column: span 2;
        left: -#{map.get($theme, 'spacing', 's')};
        order: -1;
        padding: map.get($theme, 'spacing', 's');
        position: relative;
        right: -#{map.get($theme, 'spacing', 's')};
        top: -#{map.get($theme, 'spacing', 's')};
        width: 100%;
      }
    }
  }

  .ecl-table--zebra:not(.ecl-table--simple) {
    .ecl-table__row:nth-of-type(even) {
      background-color: transparent;
    }

    .ecl-table__cell:nth-of-type(even) {
      background-color: map.get($table, 'zebra-background');
    }
  }
}
