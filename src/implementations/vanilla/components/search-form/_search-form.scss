/**
 * Search form
 * @define search-form; weak
 */

@use 'sass:map';
@use '@ecl/vanilla-layout-grid/mixins/breakpoints';
@use '@ecl/vanilla-utility-screen-reader/screen-reader';

// Exposed variables
$theme: null !default;
$search-form: null !default;

// Internal variables
$form-width-desktop: 31.25rem;
$form-width-tablet: 25rem;
$button-border-width: 1px;
$button-padding-horizontal: map.get($theme, 'spacing', 'm');
$button-padding-vertical: map.get($theme, 'spacing', 'xs');

.ecl-search-form {
  display: flex;
  margin: 0;
  position: relative;
  width: 100%;
}

.ecl-search-form .ecl-form-group {
  display: flex;
  flex-grow: 1;
  max-width: 100%;
}

.ecl-search-form__label {
  @include screen-reader.sr-only;
}

.ecl-search-form__text-input {
  border-end-end-radius: 0;
  border-inline-end-width: 0;
  border-start-end-radius: 0;
  flex-grow: 1;
  margin-top: 0 !important;
  width: 100%;
}

.ecl-search-form__button {
  background-color: map.get($search-form, 'button-background');
  border-bottom: $button-border-width solid
    map.get($search-form, 'button-border-color');
  border-end-start-radius: 0;
  border-inline-start-width: 0;
  border-inline-end: $button-border-width solid
    map.get($search-form, 'button-border-color');
  border-top: $button-border-width solid
    map.get($search-form, 'button-border-color');
  border-start-start-radius: 0;
  color: map.get($search-form, 'button-color');
  padding: calc(#{$button-padding-vertical} - #{$button-border-width})
    calc(#{$button-padding-horizontal} - #{$button-border-width});
  position: relative;

  &:hover {
    background-color: map.get($search-form, 'button-background-hover');
    border-color: map.get($search-form, 'button-border-color-hover');
    color: map.get($search-form, 'button-color-hover');
  }

  &:focus-visible {
    border-width: 2px;
    padding: calc(#{$button-padding-vertical} - 2px)
      calc(#{$button-padding-horizontal} - 2px);
  }

  &:active {
    background-color: map.get($search-form, 'button-background-active');
    color: map.get($search-form, 'button-color-active');
  }

  &[disabled] {
    background-color: rgba(map.get($search-form, 'button-background'), 0.5);
    border-color: rgba(map.get($search-form, 'button-border-color'), 0.5);
    color: rgba(map.get($search-form, 'button-color'), 0.5);
  }

  &[disabled]:hover {
    background-color: rgba(
      map.get($search-form, 'button-background-hover'),
      0.5
    );
    color: rgba(map.get($search-form, 'button-color-hover'), 0.5);
  }

  &::before {
    content: '';
    background-color: map.get($search-form, 'separator-color');
    display: block;
    height: map.get($theme, 'line-height', 'm');
    left: -1px;
    position: absolute;
    top: $button-padding-vertical;
    width: 1px;
  }
}

.ecl-search-form__button .ecl-button__label {
  display: none;
  margin-inline-start: 0;
}

.ecl-search-form__button .ecl-button__icon {
  display: block;
  fill: currentcolor;
  margin: 0;
}

/* stylelint-disable-next-line order/order */
@include breakpoints.up('m') {
  .ecl-search-form {
    max-width: $form-width-tablet;
  }

  .ecl-search-form__button .ecl-button__label {
    display: block;
  }

  .ecl-search-form__button .ecl-button__icon {
    margin-inline-end: map.get($theme, 'spacing', 'xs');
  }
}

/* stylelint-disable-next-line order/order */
@include breakpoints.up('l') {
  .ecl-search-form {
    max-width: $form-width-desktop;
  }
}
