{% spaceless %}

{#
  Parameters:
  - "item" (object) (default: {})
    - "path" (string) (default: '')
    - "alt" (string) (default: '')
    - "meta" (string) (default: '')
    - "icon" (object) (default: {}): object of type icon
    - "share_path" (string) (default: '')
    - "video" (optional) (array) (default: [])
    - "image" (optional) (array) (default: [])
  - "extra_classes" (optional) (string) (default: '')
  - "extra_attributes" (optional) (array) (default: [])
    - "name" (string) Attribute name, eg. 'data-test'
    - "value" (string) Attribute value, eg: 'data-test-1'
  - "_compliance_" (boolean) (default: false) Activates debug
#}

{# variables #}

{% set _css_class = 'ecl-gallery__item' %}
{% set _extra_attributes = '' %}
{% set _use_arial = '' %}
{% set _media_href = '' %}
{% set _media_share_path = '' %}
{% set _image_alt = '' %}
{% set _item = item|default({}) %}
{% set _compliance = _compliance_|default(false) %}
{% set _has_icon = (_item.icon is defined and _item.icon is not empty) and
  (_item.icon.name is defined and _item.icon.name is not empty) %}

{# Internal logic - Process properties #}

{% if extra_classes is defined and extra_classes is not empty %}
  {% set _css_class = _css_class ~ ' ' ~ extra_classes %}
{% endif %}

{# Setting up Video and image variables #}
{% if _item and _item is not empty %}
  {% set _media_share_path = _item.share_path %}

  {% if _item.video is defined and _item.video is not empty %}
    {% set _media_href = _item.video.sources[0].src %}
  {% else %}
    {% if _item.image is defined and _item.image is not empty %}
      {% set _media_href = _item.image.src %}
      {% set _image_alt = _item.image.alt %}
    {% else %}
      {% set _media_href = _item.path %}
      {% set _image_alt = _item.alt %}
    {% endif %}
    {# Use Arial only for image. #}
    {% set _use_arial = 'aria-label="' ~ _image_alt ~ '"' %}
  {% endif %}
{% endif %}

{% if extra_attributes is defined and extra_attributes is not empty and extra_attributes is iterable %}
  {% for attr in extra_attributes %}
    {% if attr.value is defined %}
      {% set _extra_attributes = _extra_attributes ~ ' ' ~ attr.name ~ '="' ~ attr.value|e ~ '"' %}
    {% else %}
      {% set _extra_attributes = _extra_attributes ~ ' ' ~ attr.name %}
    {% endif %}
  {% endfor %}
{% endif %}

{# Print the result #}

<li class="{{ _css_class }}"{{ _extra_attributes|raw }}>
  <a
    href="{{ _media_href }}"
    class="ecl-gallery__item-link"
    {{ _use_arial|raw }}
    data-ecl-gallery-item
    data-ecl-gallery-item-share="{{ _media_share_path }}"
  >
  {% if _item is not empty %}
    <figure class="ecl-gallery__image-container">
      {% if _item.video is defined and _item.video is not empty %}
        {% include '@ecl-twig/ec-component-gallery/ecl-video.html.twig' %}
      {% else %}
        <img src="{{ _media_href }}" alt="{{ _image_alt }}" class="ecl-gallery__image" />
      {% endif %}
      {% if _has_icon %}
        {% include '@ecl-twig/ec-component-icon/ecl-icon.html.twig' with {
          icon: _item.icon|merge({
            size: "l",
          }),
          extra_classes: 'ecl-gallery__image-icon',
          _compliance_: _compliance,
          _compliance_inner_check_: true
        } only %}
      {% endif %}
      <figcaption
        class="ecl-gallery__description"
        data-ecl-gallery-description
      >
        {{- _item.description -}}
        {% if _has_icon %}
          {%- include '@ecl-twig/ec-component-icon/ecl-icon.html.twig' with {
            icon: _item.icon|merge({
              size: "l",
            }),
            extra_classes: 'ecl-gallery__description-icon',
            _compliance_: _compliance,
            _compliance_inner_check_: true
          } only %}
        {% endif %}
        {% if _item.meta is defined and _item.meta is not empty %}
        <span class="ecl-gallery__meta" data-ecl-gallery-meta>
          {{- _item.meta -}}
        </span>
        {% endif %}
      </figcaption>
    </figure>
  {% endif %}
  </a>
</li>

{# Validation #}

{% if _compliance %}
  {% include '@ecl-twig/ec-component-ecl-compliance/components/ecl-compliance-gallery-item.html.twig' with {
    item: _item
  } only %}
{% endif %}

{% endspaceless %}
